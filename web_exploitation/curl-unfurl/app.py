from flask import Flask, request, render_template_string

app = Flask(__name__)

BROWSER_TEMPLATE = """
<!DOCTYPE html>
<html>
<head>
    <title>Curl Me, Unfurl Me</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            color: #eee;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            text-align: center;
            padding: 50px;
            max-width: 700px;
        }
        h1 {
            font-size: 48px;
            color: #00d9ff;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
            margin-bottom: 30px;
        }
        .message {
            font-size: 20px;
            line-height: 1.8;
            margin: 20px 0;
            color: #aaa;
        }
        .emoji {
            font-size: 80px;
            margin: 30px 0;
        }
        .hint {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 4px solid #00d9ff;
        }
        .code {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="emoji">ğŸŒ</div>
        <h1>Curl Me, Unfurl Me</h1>
        <p class="message">
            Hello, browser user! ğŸ‘‹
        </p>
        <p class="message">
            I see you're using: <strong>{{ user_agent }}</strong>
        </p>
        <p class="message">
            This page looks different depending on who's asking...
        </p>
        <div class="hint">
            ğŸ’¡ <strong>Hint:</strong> Browsers aren't the only way to visit websites.
            <br>
            Sometimes, you need to <span class="code">curl</span> up with a good URL! ğŸ¥Œ
        </div>
    </div>
</body>
</html>
"""

CURL_TEMPLATE = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘               ğŸ‰  CURL ME, UNFURL ME  ğŸ‰                     â•‘
â•‘                                                               â•‘
â•‘  Congratulations! You used curl like a true hacker!          â•‘
â•‘                                                               â•‘
â•‘  Browsers show one face, but curl reveals the truth...       â•‘
â•‘                                                               â•‘
â•‘  Here's your flag:                                           â•‘
â•‘                                                               â•‘
â•‘  ğŸš© DSCCTF{{curl_unf0ld5_th3_truth_2026}}                      â•‘
â•‘                                                               â•‘
â•‘  User-Agent detected: {user_agent}
â•‘                                                               â•‘
â•‘  Remember: Not all content is meant for browsers! ğŸ’»         â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

@app.route('/')
def home():
    user_agent = request.headers.get('User-Agent', 'Unknown')
    
    # Check if request is from curl or similar CLI tool
    if 'curl' in user_agent.lower():
        return CURL_TEMPLATE.format(user_agent=user_agent), 200, {'Content-Type': 'text/plain'}
    
    # Check for other CLI tools
    cli_tools = ['wget', 'httpie', 'fetch']
    if any(tool in user_agent.lower() for tool in cli_tools):
        return CURL_TEMPLATE.format(user_agent=user_agent), 200, {'Content-Type': 'text/plain'}
    
    # Default: return browser version
    return render_template_string(BROWSER_TEMPLATE, user_agent=user_agent)

@app.route('/hint')
def hint():
    return """
    <html>
    <head><title>Hint</title></head>
    <body style="background: #1a1a2e; color: #eee; font-family: monospace; padding: 50px; text-align: center;">
        <h1>Need a hint? ğŸ¤”</h1>
        <p style="font-size: 20px;">Think about the challenge name: "Curl Me, Unfurl Me"</p>
        <p style="font-size: 18px; color: #aaa;">What tool is often used to "curl" URLs from the command line?</p>
        <p style="font-size: 16px; margin-top: 30px;">
            <code style="background: #000; padding: 10px; border-radius: 5px; color: #0f0;">
                curl http://example.com
            </code>
        </p>
        <p><a href="/" style="color: #00d9ff;">Back to Challenge</a></p>
    </body>
    </html>
    """

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=False)
