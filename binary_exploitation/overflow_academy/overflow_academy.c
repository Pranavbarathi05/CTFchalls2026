#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/mman.h>

#define BUFFER_SIZE 100

void setup() {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
}

void vulnerable_function() {
    char buffer[BUFFER_SIZE];
    
    printf("Welcome to Overflow Academy!\n");
    printf("This is a basic buffer overflow challenge.\n");
    printf("Can you inject shellcode to spawn a shell?\n\n");
    
    printf("Buffer address: %p\n", buffer);
    printf("Enter your payload: ");
    
    // Vulnerable: no bounds checking!
    fgets(buffer, sizeof(buffer) + 50, stdin);  // Intentionally vulnerable
    
    printf("You entered: %s\n", buffer);
    printf("Goodbye!\n");
}

void print_flag() {
    printf("ðŸŽ‰ Flag: DSCCTF{SHELLCODE_NINJA_2026}\n");
}

int main() {
    setup();
    
    // Make stack executable for buffer overflow practice
    if (mprotect((void*)((unsigned long)&vulnerable_function & ~0xfff), 4096, 
                 PROT_READ | PROT_WRITE | PROT_EXEC) != 0) {
        perror("mprotect failed");
    }
    
    vulnerable_function();
    return 0;
}