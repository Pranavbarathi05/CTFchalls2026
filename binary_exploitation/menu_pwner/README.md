# Menu Pwner

A **medium-difficulty binary exploitation challenge** featuring heap-based Use-After-Free vulnerability.

---

## Challenge Overview

| Field | Value |
|-------|--------|
| **Name** | Menu Pwner |
| **Category** | Binary Exploitation |
| **Difficulty** | Medium (300 pts) |
| **Flag** | `DSCCTF{h34p_pwn3r_m4st3r_2026}` |
| **Port** | 9999 |
| **Vulnerability** | Use-After-Free (UAF) |

---

## Description

A tiny note manager application with basic CRUD operations. The application contains a Use-After-Free vulnerability in the delete function that doesn't clear the freed pointer, allowing attackers to access and potentially control freed memory.

**Goal**: Trigger admin mode to read the flag.

---

## Vulnerability Details

### Use-After-Free in `delete_note()`

```c
void delete_note() {
    // ... validation code ...
    
    // VULNERABILITY: Pointer not cleared after free!
    free(notes[idx].content);
    notes[idx].active = 0;
    note_count--;
    
    printf("[+] Note %d deleted!\n", idx);
}
```

**The Problem:**
- `notes[idx].content` is freed but not set to NULL
- The pointer remains in the `notes` array
- Subsequent operations can access freed memory
- New allocations may reuse the freed chunk

---

## Building & Running

### Local Development
```bash
# Build the challenge
make

# Build debug version
make debug

# Build easier version (for beginners)
make easy

# Run with GDB
make gdb
```

### Docker Deployment
```bash
# Build container
docker build -t menu-pwner .

# Run container
docker run -p 9999:9999 menu-pwner

# Access challenge
nc localhost 9999
```

---

## Exploitation Strategy

### Basic Exploitation Steps

1. **Create a note** to allocate memory
2. **Delete the note** (triggers UAF - pointer not cleared)
3. **Create another note** of same size (reuses freed chunk)
4. **Access the deleted note** (now contains new data)

### Advanced Exploitation

1. **Information Leakage**: Use debug stats to get heap addresses
2. **Heap Spraying**: Control chunk allocation patterns
3. **Function Pointer Overwrite**: Target `trigger_admin()` function
4. **Code Execution**: Redirect control flow to admin mode

---

## Files Structure

```
menu_pwner/
├── menu_pwner.c      # Main vulnerable source
├── Makefile          # Build configuration
├── Dockerfile        # Container setup
├── start.sh          # Service launcher
├── flag.txt          # Challenge flag
├── description.md    # Challenge description
├── hint.md          # Progressive hints
├── solve.py         # Basic solve script
├── advanced_solve.py # Advanced exploitation
└── README.md        # This file
```

---

## Educational Value

This challenge teaches:

- **Heap memory management** concepts
- **Use-After-Free** vulnerability identification
- **Memory corruption** exploitation techniques
- **Debugging skills** with GDB and debug output
- **Exploitation development** process

---

## Difficulty Balancing

**Made Fair Through:**
- Debug output shows heap pointers (removes ASLR complexity)
- Source code provided (white-box testing)
- Progressive hints available
- Multiple solve paths possible

**Realistic Complexity:**
- Real-world UAF pattern
- Proper memory management failure
- Requires understanding of heap behavior
- Multi-step exploitation process

---

## Security Features (Intentionally Disabled)

- **Stack Canaries**: Disabled with `-fno-stack-protector`
- **ASLR**: Mitigated with debug pointer leaks
- **NX Bit**: Disabled with `-z execstack`
- **PIE**: Disabled with `-no-pie`

This creates a controlled environment for learning heap exploitation fundamentals.

---

## Testing

```bash
# Test basic functionality
./menu_pwner

# Test with solve script
python3 solve.py

# Test advanced exploitation
python3 advanced_solve.py

# Debug with GDB
gdb ./menu_pwner
```

---

## Flag

Successfully triggering admin mode reveals:
```
DSCCTF{h34p_pwn3r_m4st3r_2026}
```